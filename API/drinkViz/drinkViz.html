<!doctype html>
<html>
<head>
    <meta charset="UTF-8">
    <title>drinkBase</title>
    
    <script src="https://cdn.rawgit.com/eligrey/canvas-toBlob.js/f1a01896135ab378aa5c0118eadd81da55e698d8/canvas-toBlob.js"></script>
	 <script src="https://cdn.rawgit.com/eligrey/FileSaver.js/e9d941381475b5df8b7d7691013401e171014e89/FileSaver.min.js"></script>
	
    
    <script src="https://d3js.org/d3.v4.min.js" charset="utf-8"></script>
    <script type="application/javascript">

    var drinksDF;
    var ingredientsDF;
    var recipeDF;
    var prepDF;
    var theBoolPick = 'Can include ANY of';
    
    var drinksJson = {
              "Drinks": [
                {
                  "Data": {
                    "ABV": 0.1598086124401914, 
                    "AlcoholUnits": 0.835, 
                    "Brightness": 0.03, 
                    "Garnish": "lemon twist", 
                    "Glass": "", 
                    "IngredientString": "Campari | Champagne or sparkling wine | gin | lemon juice | simple syrup", 
                    "Style": "bubbly", 
                    "Sweetness": 0.3155, 
                    "Volume": 5.225
                  }, 
                  "Name": "Bitter French", 
                  "Recipe": [
                    {
                      "Amount": 0.25, 
                      "Ingredient": "Campari", 
                      "Unit": "oz"
                    }, 
                    {
                      "Amount": 2.5, 
                      "Ingredient": "Champagne or sparkling wine", 
                      "Unit": "oz"
                    }, 
                    {
                      "Amount": 1.0, 
                      "Ingredient": "gin", 
                      "Unit": "oz"
                    }, 
                    {
                      "Amount": 0.5, 
                      "Ingredient": "lemon juice", 
                      "Unit": "oz"
                    }, 
                    {
                      "Amount": 0.5, 
                      "Ingredient": "simple syrup", 
                      "Unit": "oz"
                    }
                  ]
                }, 
                {
                  "Data": {
                    "ABV": 0.31619492827868845, 
                    "AlcoholUnits": 1.0286875, 
                    "Brightness": 0.0, 
                    "Garnish": "orange twist", 
                    "Glass": "", 
                    "IngredientString": "Angostura bitters | Luxardo Maraschino | orange bitters | rye whiskey", 
                    "Style": "", 
                    "Sweetness": 0.175, 
                    "Volume": 3.253333333333334
                  }, 
                  "Name": "Fancy-Free", 
                  "Recipe": [
                    {
                      "Amount": 1.0, 
                      "Ingredient": "Angostura bitters", 
                      "Unit": "dash"
                    }, 
                    {
                      "Amount": 0.5, 
                      "Ingredient": "Luxardo Maraschino", 
                      "Unit": "oz"
                    }, 
                    {
                      "Amount": 1.0, 
                      "Ingredient": "orange bitters", 
                      "Unit": "dash"
                    }, 
                    {
                      "Amount": 2.0, 
                      "Ingredient": "rye whiskey", 
                      "Unit": "oz"
                    }
                  ]
                }, 
                {
                  "Data": {
                    "ABV": 0.15656565656565657, 
                    "AlcoholUnits": 0.775, 
                    "Brightness": 0.03, 
                    "Garnish": "lemon twist", 
                    "Glass": "coupe", 
                    "IngredientString": "Champagne or sparkling wine | gin | lemon juice | simple syrup", 
                    "Style": "bubbly", 
                    "Sweetness": 0.3155, 
                    "Volume": 4.95
                  }, 
                  "Name": "French 75", 
                  "Recipe": [
                    {
                      "Amount": 2.5, 
                      "Ingredient": "Champagne or sparkling wine", 
                      "Unit": "oz"
                    }, 
                    {
                      "Amount": 1.0, 
                      "Ingredient": "gin", 
                      "Unit": "oz"
                    }, 
                    {
                      "Amount": 0.5, 
                      "Ingredient": "lemon juice", 
                      "Unit": "oz"
                    }, 
                    {
                      "Amount": 0.5, 
                      "Ingredient": "simple syrup", 
                      "Unit": "oz"
                    }
                  ]
                }, 
                {
                  "Data": {
                    "ABV": 0.17028985507246377, 
                    "AlcoholUnits": 1.175, 
                    "Brightness": 0.045, 
                    "Garnish": "lemon twist", 
                    "Glass": "coupe", 
                    "IngredientString": "Champagne or sparkling wine | bourbon whiskey | lemon juice | simple syrup", 
                    "Style": "built", 
                    "Sweetness": 0.3195, 
                    "Volume": 6.9
                  }, 
                  "Name": "French 95", 
                  "Recipe": [
                    {
                      "Amount": 2.5, 
                      "Ingredient": "Champagne or sparkling wine", 
                      "Unit": "oz"
                    }, 
                    {
                      "Amount": 2.0, 
                      "Ingredient": "bourbon whiskey", 
                      "Unit": "oz"
                    }, 
                    {
                      "Amount": 0.75, 
                      "Ingredient": "lemon juice", 
                      "Unit": "oz"
                    }, 
                    {
                      "Amount": 0.5, 
                      "Ingredient": "simple syrup", 
                      "Unit": "oz"
                    }
                  ]
                }
              ]
            };

    
    var theXPick = 'Sugar';
    var theYPick = 'Alcohol';
        
    // for recipe on and off
    var showRecipeCounter = 0;
        
    function switchBool() {
        var e = document.getElementById("boolPicker");
        theBoolPick = e.options[e.selectedIndex].text;
        console.log(theBoolPick);
    }
    
    function switchX() {
        var e = document.getElementById("xPicker");
        theXPick = e.options[e.selectedIndex].text;
        console.log(theXPick);
    }
    function switchY() {
        var e = document.getElementById("yPicker");
        theYPick = e.options[e.selectedIndex].text;
        console.log(theYPick);
    }
        
    /*function getData() {
        //populate drink list
        d3.csv('data/all_drinks.csv', function(d) {
            drinksDF = d;
            drawPlot();
        });
        //populate drop down
        d3.csv("data/chemistry.csv", function(d) {
            ingredientsDF = d;
            fillIngredients();
        });
        //get recipes
        d3.csv("data/recipe.csv", function(d) {
            recipeDF = d;
        });
        //get prep
        d3.csv("data/prep.csv", function(d) {
            prepDF = d;
        });
    }*/

    function getData() {
        //populate drink list
        console.log(drinksJson.Drinks[0])
        /*d3.json(drinksJson, function(d) {
            drinksDF = d3.hierarchy(d);
            console.log(drinksDF[0])
            console.log(drinksDF.drinks[0])
            
        }); */
        drawPlot();
    }

    // fill the drop down menu
        /*
    function fillIngredients() {

        var inputText = document.getElementById('searchText').value;
        
        d3.select("#ingredientDropDown").selectAll("option").remove();
        
        var p = d3.select("#ingredientDropDown").selectAll("option")
                //.data(ingredientsDF)
                .data(ingredientsDF.filter(function(d) {
                        return d.ingredient.toLowerCase().match(RegExp(inputText.toLowerCase()))
                    }))
                .enter()
                .append("option")
                .text(function(d) {
                    return d.ingredient
                });
        
        document.getElementById("ingredientDropDown").selectedIndex = -1;
    }
        
    // filter the drop down menu
    function searchTextFilter() {
        return 'naw'
    }
    
    // for filtering
    var thePicks = []
    var pickCounter = 0
    
    function clearPicks() {
        thePicks = [];
        d3.select("#ingredientDiv").selectAll("span").remove();
        pickCounter = 0;
        drawPlot();
    }

    function addToFilter() {
        pickCounter += 1
        var e = document.getElementById("ingredientDropDown");
        var thePick = e.options[e.selectedIndex].text

        thePicks.push(thePick)
        //
        var pickSpan = d3.select("#ingredientDiv").selectAll("span")
            .data(thePicks)
            .enter()
            .append("span")
            .text(function(d) {
                if (pickCounter > 1) {
                    if (theBoolPick == 'Can include ANY of') {
                        return ' or ' + d
                    } else {
                        return ' & ' + d
                    }
                    
                } else {
                    return d
                }
            });
        //
        console.log(thePicks);
        e.value = 'start'
    }
        
    function checkPicks(ingredients) {
        //ingredients = ingredients.split('|') //turn this on for exact matching
        // return True False for whether ANY or ALL of thePicks are in ingredients
        if (theBoolPick == 'Can include ANY of') {
            var boolReturn = thePicks.some(function(v) { return ingredients.indexOf(v) >= 0; })
        } else {
            var boolReturn = thePicks.every(function(v) { return ingredients.indexOf(v) >= 0; })
        }
        // (reverse the boolean if thePicks is cleared)
        if (thePicks.length > 0) {
            return boolReturn
        } else {
            return !(boolReturn)
        }
        //return boolReturn
    }
    */
        
    // draws the plot
    function drawPlot() {
        drinksSVG = d3.select('#theDrinks');
        
        drinksSVG.append("line")
                    .attr("x1",200)
                    .attr("x2",725)
                    .attr("y1",300)
                    .attr("y2",300)
                    .attr("stroke","#888");
        
        drinksSVG.append("line")
                    .attr("x1",462)
                    .attr("x2",462)
                    .attr("y1",45)
                    .attr("y2",560)
                    .attr("stroke","#888");

        drinksSVG.append("text")
                .text("<- (less)        Sugar        (more) ->")
                .attr ("x",462)
                .attr ("y",615)
                .attr ("text-anchor", "middle")
                .attr ("alignment-baseline", "ideographic")
                .style ("fill","#444")
                .style ("font-size","13pt")
                .attr ("opacity", 0.4);
        
        drinksSVG.append("text")
                .text("<- (less)        Alcohol        (more) ->")
                //.text("<- (less)        Acidity        (more) ->")
                .attr ("x",875)
                .attr ("y",310)
                .attr ("text-anchor", "middle")
                .attr ("alignment-baseline", "ideographic")
                .style ("fill","#444")
                .style ("font-size","13pt")
                .attr ("opacity", 0.4)
                .attr('transform', 'rotate(270 875 295)');
        
        drinksSVG.selectAll("circle").remove()

        var theOffset = 0;
        
        var abvCirc = drinksSVG.selectAll("#abvCircle")
                .data(drinksJson.Drinks)
                .enter().append("circle")
                .attr("id", "abvCircle")
                /*.attr ("stroke-width", function(d) {
                        if (checkPicks(d.ingredients)) {
                            return 0.75
                        } else {
                            return 0.2
                        }
                    })*/
                .attr ("stroke", '#999')
                //.attr ("cx",function(d) { return Math.max(30, (d.Data.Sweetness * 6000));})
                //.attr ("cy",function(d) { return Math.max(30, (630 - (d.Data.AlcoholUnits * 1800)));})
                //.attr ("cy",function(d) { return Math.max(50, (550 - (d.Data.Brightness * 50000)));})
                .attr ("cx",function(d) { 
                    if (theXPick == "Sugar") {
                        //return Math.min(Math.max(30, (d.Data.Sweetness * 6500) - 25), 825);
                        return Math.min(Math.max(30, (d.Data.Sweetness * 2000) - 25), 825);
                    } else if (theXPick == "Alcohol") {
                        return Math.max(30, (d.Data.AlcoholUnits * 2500)); // ABV
                        //return Math.max(30, (d.Data.AlcoholUnits * d.Data.Volume * 500)); // content
                    } else if (theXPick == "Acidity") {
                        return Math.min(900, Math.max(50, (d.Data.Brightness * 80000)));
                    }
                })
                .attr ("cy",function(d) { 
                    if (theYPick == "Sugar") {
                        return Math.max(30, (d.Data.Sweetness * 6000));
                    } else if (theYPick == "Alcohol") {
                        //return Math.min(Math.max(30, (630 - (d.Data.AlcoholUnits * 1800))), 570);
                        return Math.min(Math.max(30, (630 - (d.Data.AlcoholUnits * 400))), 570);// ABV
                        //return Math.max(30, (630 - (d.Data.AlcoholUnits * d.Data.Volume * 400))); //content
                    } else if (theYPick == "Acidity") {
                        return Math.max(50, (550 - (d.Data.Brightness * 50000)));
                    }
                })
                .attr ("r",function(d) { return (d.Data.Volume * Math.min(d.Data.Volume, 3)) + 3; })
                .attr ("fill-opacity", function(d) {
                        /*if (checkPicks(d.ingredients)) {
                            return 0.85
                        } else {
                            return 0.1
                        }*/
                        return 0.8
                    })
                .attr("fill",function(d) { 
                        if (d.Data.Style.includes("stirred")) {
                            return "#a5693d";
                        } else if (d.Data.Style.includes("bubbly")) {
                            return "#fcf5bf";
                        } else if (d.Data.Style.includes("shaken")) {
                            return "#100656";
                            //return "#240ccc";
                        } else if (d.Data.Style.includes("fizz")) {
                            return "#f4e381";
                        } else if (d.Data.Style.includes("swizzle")) {
                            return "#f27552";
                        }    else if (d.Data.Style.includes("built")) {
                            return "#b5390c";
                        } else {
                            return "#bbb";
                        }
                    })
                .on("mouseover", highlight)
                .on("mouseout", unhighlight)
                .on("click", fillRecipe);
        
        /*var acidCirc = drinksSVG.selectAll("#acidCircle")
                .data(drinksDF)
                .enter().append("circle")
                .attr("id", "acidCircle")
                .attr ("cx",function(d) { return Math.max(30, (d.Data.Sweetness * 6000));})
                .attr ("cy",function(d) { return Math.max(30, (630 - (d.Data.AlcoholUnits * 1800)));})
                .attr ("fill-opacity",0.001)
                .attr ("opacity", function(d) {
                        if (d.selected == 1) {
                            return 0.9
                        } else {
                            return 0.1
                        }
                    })
                .attr ("stroke-width", 1)
                .attr ("stroke", '#444')
                .attr ("r",function(d) { return (d.Data.Brightness * 2000) + 3; });
                .on("mouseover", function(d){
                    hoverText.transition().duration(200).style("opacity", .9);
                    hoverText.text(d.name)	
                        .style("left", (d3.event.pageX) + "px")		
                        .style("top", (d3.event.pageY - 28) + "px")
                })
                .on("mouseout", function(){
                    hoverText.transition().duration(200).style("opacity", 0);
                });*/

        /*var meltCirc = drinksSVG.selectAll("#meltCircle")
        .data(drinksDF)
            .enter().append("circle")
            .attr("id", "meltCircle")
                .attr ("cx",function(d) { return Math.max(30, (d.Data.Sweetness * 6000));})
                .attr ("cy",function(d) { return Math.max(30, (630 - (d.Data.AlcoholUnits * 1800)));})
                .attr ("r",function(d) { return (d.Data.Volume * d.Data.Volume) + 3; })
                .attr ("fill-opacity",0.0)
                .attr ("opacity",0.25)
                .attr ("stroke-width", function(d) { return d.melt * 10;})
                .attr ("stroke", '#7BF');*/
        
        
    }        
        
        
    // the tooltip functions
    
    function highlight(d,i) {
        
        var circle = d3.select(this)
            .attr("fill-opacity",1)
            .attr("stroke-width",1.5);
        
        d3.select("#tooltip")
            .style("left", d3.event.pageX + 5 + "px")
            .style("top", d3.event.pageY - 30 + "px")
            //.text(d.Name)
            .style("visibility","visible");
        
        d3.select("#drinkName").text(d.Name);
        d3.select("#drinkStyle").text(d.Data.Style);
        d3.select("#drinkIngredients").text(d.Data.IngredientString);
        
    }

    function unhighlight(d,i) {
        
        var circle = d3.select(this)
            .attr("fill-opacity", function(d) {
                        /*if (checkPicks(d.ingredients)) {
                            return 0.95
                        } else {
                            return 0.05
                        }*/
                        return 0.95
                    })
            .attr ("stroke-width", function(d) {
                        /*if (checkPicks(d.ingredients)) {
                            return 0.75
                        } else {
                            return 0.2
                        }*/
                        return 0.75
                    });
        
        d3.select("#tooltip")
            .style("visibility","hidden");
    }
        
    function showRecipe() {
        showRecipeCounter += 1;
        if (showRecipeCounter % 2 == 1) {
            d3.select("#recipeBox")
                .style("visibility","visible");
            //circleOpacity = 0.1;
            //plotNewStats();
        } else {
            d3.select("#recipeBox")
                .style("visibility","hidden");
            //circleOpacity = 1;
        }
    }
    
    function fillRecipe(d) {
        var thisName = d.Name
        console.log(thisName);
        d3.select("#recipeTitle").text(thisName).style("font-weight", "bold");
        
        d3.select("#recipeBox").selectAll('#recipeIng').remove();
        d3.select("#recipeBox").selectAll('#recipeBody').remove();
        
        var rec = d3.select("#recipeBox").selectAll("#recipeIng")
                .data(drinksJson.Drinks.filter(function(d) { return d.Name == thisName }))
                .enter()
                .append("div")
                .attr('id', 'recipeIng')
                .text(function(d) {
                    return d.Recipe.Amount + ' ' + d.Recipe.Unit + ' ' + d.Recipe.Ingredient;
                });

        var inst = d3.select("#recipeBox").selectAll("#recipeBody")
                .data(drinksJson.Drinks.filter(function(d) { return d.Name == thisName }))
                .enter()
                .append("p")
                .attr('id', 'recipeBody')
                .text(function(d) {
                    var prepDirections = '';
                    // style
                    /*if (d.notes.length > 0) {
                        prepDirections += d.notes
                    } else */
                    if (d.Data.Style.includes("stirred")) {
                        prepDirections += "Combine ingredients in mixing glass and stir with ice until cold, then strain into glass.";
                    } else if (d.Data.Style.includes("bubbly")) {
                        prepDirections += "Stir all but bubbly with ice until cold. Strain and top with bubbly.";
                    } else if (d.Data.Style.includes("shaken")) {
                        prepDirections += "Combine ingredients in shaker and shake with ice until cold, then strain into glass.";
                    } else if (d.Data.Style.includes("fizz")) {
                        prepDirections += "Dry shake all ingredients (no ice) for 10 seconds. Then add ice and shake until cold. Strain into glass.";
                    } else if (d.Data.Style.includes("built")) {
                        prepDirections += "Build ingredients in serving glass, over ice. Stir and enjoy.";
                    } else if (d.Data.Style.includes("hot")) {
                        prepDirections += "Combine all ingredients and serve hot.";
                    }
                    //glass
                    prepDirections += ' Serve in ' + d.glass + ' glass.';
                    //
                    return prepDirections;
                });
        
    }
        
    </script>
    
    <style>
        
        .bigPlot {
            visibility: visible;
            background-color: rgba(200, 200, 200, 0.2);
        }
        
        .divider {
            visibility: visible;
            background-color: rgba(150, 150, 150, 0.2);
        }
        
        *{font-family:"Trebuchet MS";}
        
        div.tooltip {	
            position: absolute;			
            pointer-events: none;			
        }

                
        .big-btn {
            color: #fcf5bf;
            background-color: #100656;
            width: 125px;
            height: 30px;
            font-size: 20px;
            border-radius: 8px;
            text-indent: 8px;
            margin: 7px 0px;
            padding-top: 3px;
        }
        
        #recipeBox {
            position: absolute;
            top: 270px;
            left: 325px;
            width: 250px;
            visibility: hidden;
            padding: 3px 15px 5px 15px;
            background-color: #ccc;
            border-style: double;
            text-align: center;
        }
        
        #searchText {
            width: 200px;
        }
        
        
    </style>
    
    
</head>
<body onload="setTimeout(getData,500)">
    <!--<div class="axisPickers">
        <select style="position: relative; top: 643px; left: 430px; font-size: 8pt;" id="xPicker" onchange="switchX();drawPlot()">
          <option selected="selected">Sugar</option>
          <option>Alcohol</option>
          <option>Acidity</option>
        </select>
        <select id="yPicker" style="position: relative; top: 370px; left: 765px; font-size: 8pt; transform: rotate(270 415 650);" onchange="switchY();drawPlot()">
          <option>Sugar</option>
          <option selected="selected">Alcohol</option>
          <option>Acidity</option>
        </select>
    </div>--> 
    <h3 style="position: absolute; padding: 10px;">Drinks</h3>
    <div class='thePlot' onclick="showRecipe();">
        <svg class="bigPlot" id="theDrinks" width="925" height="630"></svg>
    </div>
    <div id="tooltip" class="tooltip">
        <span id="drinkName" style="font-weight: bold"></span><br />  
        <span id="drinkStyle" style="font-size: 10pt"></span> :
        <span id="drinkIngredients" style="font-size: 8pt"></span>
    </div>
    <div id="recipeBox">
        <p id="recipeTitle">Click on a drink to see the recipe</p>
        <p id="recipeIng"></p>
        <p id="recipeBody"></p>
    </div>
</body>
</html>
